<%- include('../partials/head') -%> <%- include('../partials/header') -%>

<div class="container">
	<%- include('../partials/messages') -%>
	<div class="collapse mb-5" id="writePost">
		<form action="/user/post" method="post">
			<div class="form-group">
				<textarea
					class="form-control"
					id="writePost"
					name="article"
					rows="3"
					placeholder="What is on your mind?"
				></textarea>
			</div>
			<button class="btn btn-primary btn-lg" type="submit">Post</button>
		</form>
	</div>

	<main class="mainBody">
		<% allPost.forEach((post) => { %>
		<div class="card">
			<div class="card-content">
				<div class="user-details">
					<div class="avatar-circle">
						<span class="initials"> <%= post.user.avatar %> </span>
					</div>
					<div class="user-details_name">
						<span> <span class="tag">@</span><%= post.user.username %> </span>
					</div>
					<cite class="timestamp"> <%= moment(post.createdAt).fromNow() %></cite>
				</div>
				<div class="post-card text-dark">
					<div class="media">
						<div class="media-body">
							<p class="post-article"><%= post.article %></p>
						</div>
					</div>
				</div>
				<hr />
				<div class="interaction-section d-flex">
					<div class="d-flex mx-4">
						<form action="/user/like-post/<%- post._id %>" method="POST">
							<input type="text" name="like" value="like" style="display: none" />
							<button class="like-btn" type="submit">
								<a><i class="fa fa-heart text-primary" aria-hidden="true"></i></a>
							</button>
						</form>
						<p><%= post.likes.length %>&nbsp; likes</p>
					</div>
					<div class="d-flex mx-2">
						<a
							class="mr-2"
							data-toggle="collapse"
							href="#writeComment"
							role="button"
							aria-expanded="false"
						>
							<i class="fas fa-comments"></i>
						</a>
						<p><%= post.comments.length %>&nbsp; comments</p>
					</div>
				</div>
				<div class="collapse" id="writeComment">
					<div class="card card-body">
						<form action="/user/comment-post/<%- post._id %>" method="post">
							<div class="form-group">
								<textarea
									class="form-control"
									id="statement"
									name="statement"
									rows="3"
									placeholder="Write a public comment"
								></textarea>
							</div>
							<button class="btn btn-primary" type="submit">Comment</button>
							<a
								class="btn btn-secondary ml-2"
								data-toggle="collapse"
								href="#seeComment"
								role="button"
								aria-expanded="false"
								role="button"
								class="btn btn-secondary"
								>View Comments</a
							>
						</form>
					</div>
					<% post.comments.forEach(comment => { %>
					<div class="collapse card" id="seeComment">
						<div class="card-content mt-3">
							<div class="user-details">
								<div class="avatar-circle">
									<span class="initials"> <%= comment.user.avatar %> </span>
								</div>
								<div class="user-details_name">
									<span> <span class="tag">@</span><%= comment.user.username %> </span>
								</div>
								<cite class="timestamp"> <%= moment(comment.createdAt).fromNow() %></cite>
							</div>
							<div class="media-body">
								<p class="comment-statement"><%= comment.statement %></p>
							</div>
						</div>
						<div class="d-flex justify-content-between mt-4">
							<div class="d-flex">
								<form action="/user/like-comment/<%- comment._id %>" method="POST">
									<input type="text" name="like" value="like" style="display: none" />
									<button class="like-btn" type="submit">
										<a><i class="fa fa-heart text-primary" aria-hidden="true"></i></a>
									</button>
								</form>
								<p><%= comment.likes.length %>&nbsp; likes</p>
							</div>
							<div></div>
							<div></div>
						</div>
					</div>
					<% }) %>
				</div>
			</div>
		</div>
		<hr class="partition" />
		<% }) %>
	</main>
</div>

<%- include('../partials/foot') -%>
